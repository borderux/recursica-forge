# Pull Request Checks
#
# Purpose: Validates that pull requests pass tests and build successfully.
#
# This workflow runs on every pull request to ensure:
# 1. All tests pass (npm run test)
# 2. The application builds successfully (npm run build)
#
# If either step fails, the PR check will fail and block merging.
#
# Note: This workflow skips running on PRs titled "Version Packages" (created by changesets),
# as those PRs are automatically generated and will be validated when merged.

name: PR Checks

on:
  pull_request:
    branches:
      - main

permissions:
  contents: read

jobs:
  test-and-build:
    name: Pull Request Test and Build
    runs-on: ubuntu-latest
    if: github.event.pull_request.title != 'Version Packages'
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies
        run: npm ci
        env:
          HUSKY: 0

      - name: Run Tests
        run: npm run test -- --run
        env:
          # Environment variables are optional for tests
          VITE_RECURSICA_API_URL: ${{ vars.VITE_RECURSICA_API_URL || '' }}
          VITE_RECURSICA_UI_URL: ${{ vars.VITE_RECURSICA_UI_URL || '' }}
          VITE_PLUGIN_PHRASE: ${{ secrets.PLUGIN_PHRASE || '' }}

      - name: Build
        run: npm run build
        env:
          # Environment variables are optional for build (only needed for runtime)
          VITE_RECURSICA_API_URL: ${{ vars.VITE_RECURSICA_API_URL || '' }}
          VITE_RECURSICA_UI_URL: ${{ vars.VITE_RECURSICA_UI_URL || '' }}
          VITE_PLUGIN_PHRASE: ${{ secrets.PLUGIN_PHRASE || '' }}
